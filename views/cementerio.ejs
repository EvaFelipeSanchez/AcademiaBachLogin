<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>AcademiaBach</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <style>
     .sidebaror {
        position: relative;
          transition: 0.3s;
          display: flex;
          flex-direction: column;
          
      }

      .sidebaror img {
            width: 85%;
            height: auto;
            margin-top: 2.5%;
            }

     .sidebar {
          height: 150%;
          width: 9%;
          position: fixed;
          top: 0;
          left: -150%; 
          background-color: #acc1e5;
          transition: 0.3s;

      }

      .sidebar a {
          padding: 7%;
          text-decoration: none;
          font-size: 1vw;
          color: #1c4b6a;
          display: block;
      }

      .sidebar img {
      width: 100%;
      height: auto;

      }

      .sidebar a:hover {
          background-color: #acc1e5;
      }


      .content {
          margin-left: 5%;
          padding: 7%;
      }

      .content a img {
        position: fixed;
        left: 1%;
        top: 1%;
        width: 7%;
        height: auto;
        z-index: 3;
        }

        body {
        background-image: url('/images/Fondo3.png');  
        background-size: cover;               

        margin: 0;
        padding: 0;
        overflow: hidden; 
        display: flex;
        flex-direction: column;
        min-height: 100vh;
        }

        main {
        display: flex;
        flex-direction: column;
        }

        header{
            background-color: rgb(31, 39, 78);
            color: white;
            text-align: center;
            padding: 0.5%;
        
        }

        footer {
            background-color: rgb(31, 39, 78);
            color: white;
            text-align: center;
            padding: 0.5%;
            margin-top: auto;
        }
            
            
        .header-container {
            display: flex;
            align-items: center;
            justify-content: space-between; 
        }


        .cementerio {
            position: fixed;
            top: 5%;
            left: 20%; 
            width: 75%;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-wrap: wrap;
            transform: translate(-10%, 5%);
            overflow-y: auto; 
            max-height: 85vh;
        }

        .item {
            background-color: #acc1e5;
            border: 1px solid #1b184f;
            padding: 8px;
            margin: 10px;
            text-align: center;
        }

        .cerrar {
             position: fixed;
            display: flex;
            justify-content: center;
            align-items: center;
            top: 13%; 
            left: 95%; 
            transform: translate(-50%, -50%); 
            color: rgb(31, 39, 78);

        }

        .cerrar img {
            max-width: 121%;
            height: auto;
        }


        .cementerio img {
            max-width: 50%;
        }

        .nombreUsuario1 {
            font-size: 1.3vw;
            text-align: right;
            color: rgb(255, 255, 255);
            font-family: 'Arial', sans-serif; 
            background-color: rgb(31, 39, 78);
            z-index: 10;
            margin: 0;
        }

        @media screen and (max-width: 600px) {
            
            .sidebaror {
                position: relative;
                transition: 0.3s;
                display: flex;
                flex-direction: row; 

            }

            .sidebar {
                height: 10%; 
                width: 90%; 
                position: fixed;
                top: 5.5%;
                left: -150%;
                background-color: #acc1e5;
                transition: 0.3s;
                display: flex; 
                flex-direction: row; 
                align-items: center; 
                font-size: 150%;

            }

            .sidebar a {
                padding: 1%; 
                text-decoration: none;
                font-size: 1vw;
                color: #1c4b6a;
                display: inline-block; 
            }

            .sidebar img {
                width: 50%;
                margin-left: 0;
            }

            .sidebar a:hover {
                background-color: #acc1e5;
            }

            .content a img {
                position: fixed;
                left: 1%;
                top: 4%;
                width: 10%;
                height: auto;
                z-index: 3;
            }

            header{
            background-color: rgb(31, 39, 78);
            color: white;
            text-align: center;
            padding: 2%;

            }

            footer {
            background-color: rgb(31, 39, 78);
            color: white;
            text-align: center;
            padding: 2%;
            margin-top: auto;
            }

 
            .nombreUsuario1 {
            font-size: 2.3vw;
            text-align: right;
            color: rgb(255, 255, 255);
            font-family: 'Arial', sans-serif; 
            background-color: rgb(31, 39, 78);
            z-index: 10;
            margin: 0;
            }

 

            .cerrar {
            position: fixed;
            display: flex;
            justify-content: center;
            align-items: center;
            top: 21%; 
            left: 91%; 
            transform: translate(-50%, -50%); 
            color: rgb(31, 39, 78);

            }

            .cerrar img {
            max-width: 120%;
            height: auto;
            }

            
            .cementerio {
                position: fixed;
                top: 13%;
                left: 17%; 
                width: 75%;
                display: flex;
                justify-content: center;
                align-items: center;
                flex-wrap: wrap;
                transform: translate(-10%, 5%);
                overflow-y: auto; 
                max-height: 75vh;
                font-size: 2vw;
            }

            .cementerio img{
                width: 40%;
            }

            .item {
                background-color: #acc1e5;
                border: 1px solid #1b184f;
                padding: 1%;
                margin: 7px;
                text-align: center;
                width: 40%;
                height: auto;
            }


         }



            @media screen and (min-width: 601px) and (max-width: 1024px) {
            .sidebaror {
                position: relative;
                transition: 0.3s;
                display: flex;
                flex-direction: column;
                
            }

            .sidebaror img {
                    width: 95%;
                    height: auto;
                    margin-top: 2.5%;
                    }

            .sidebar {
                height: 150%;
                width: 13%;
                position: fixed;
                top: 0;
                left: -150%; 
                background-color: #acc1e5;
                transition: 0.3s;

            }

            .sidebar a {
                padding: 7%;
                text-decoration: none;
                font-size: 1vw;
                color: #1c4b6a;
                display: block;
            }

            .sidebar img {
            width: 110%;
            height: auto;

            }

            .sidebar a:hover {
                background-color: #acc1e5;
            }


            .content {
                margin-left: 5%;
                padding: 7%;
            }

            .content a img {
                position: fixed;
                left: 1%;
                top: 2%;
                width: 10%;
                height: auto;
                z-index: 3;
                }

                body {
                background-image: url('/images/Fondo3.png');  
                background-size: cover;               

                margin: 0;
                padding: 0;
                overflow: hidden; 
                display: flex;
                flex-direction: column;
                min-height: 100vh;
                }

                main {
                display: flex;
                flex-direction: column;
                }

                header{
                    background-color: rgb(31, 39, 78);
                    color: white;
                    text-align: center;
                    padding: 0.5%;
                
                }

                footer {
                    background-color: rgb(31, 39, 78);
                    color: white;
                    text-align: center;
                    padding: 0.5%;
                    margin-top: auto;
                }
                    
                    
                .header-container {
                    display: flex;
                    align-items: center;
                    justify-content: space-between; 
                }

            .nombreUsuario1 {
                font-size: 1.9vw;
                text-align: right;
                color: rgb(255, 255, 255);
                font-family: 'Arial', sans-serif; 
                background-color: rgb(31, 39, 78);
                z-index: 10;
                margin: 0;
            }

 
            .cerrar {
                position: fixed;
                display: flex;
                justify-content: center;
                align-items: center;
                top: 19%; 
                left: 90%; 
                transform: translate(-50%, -50%); 
                color: rgb(31, 39, 78);

            }

            .cerrar img {
                max-width: 100%;
                height: auto;
            }

            .cementerio {
                position: fixed;
                top: 13%;
                left: 24%; 
                width: 65%;
                display: flex;
                justify-content: center;
                align-items: center;
                flex-wrap: wrap;
                transform: translate(-10%, 5%);
                overflow-y: auto; 
                max-height: 70vh;
                font-size: 2vw;
            }

            .cementerio img{
                width: 80%;
            }

            .item {
                background-color: #acc1e5;
                border: 1px solid #1b184f;
                padding: 1%;
                margin: 7px;
                text-align: center;
                width: 30%;
                height: auto;
            }

            }

      
  </style>
  </head>
    
  <body>

    
    <header>
        <p class="nombreUsuario1">   Usuario conectado: <%= user.name %>  &nbsp;  &nbsp;</p>  
    </header>

    <main class="d-flex justify-content-between flex-row mb-3 flex-lg-row">

        <div class="p-2 ">    
            <div class="sidebaror " > 
                <div class="content" >
                    <a href="#" onclick="toggleSidebar()"><img src="/images/logo.png" alt="Botón de menú"></a>
                </div>
                <div class="sidebar" id="sidebar">
                    <p>&nbsp; &nbsp;</p>
                    <p>&nbsp; &nbsp;</p>
                    <p>&nbsp; &nbsp;</p>
                    <p>&nbsp; &nbsp;</p>
                    <a href="#" onclick="checklist()"><img src="/images/listaicono.png" alt="Icono Checklist"></a>
                    <a href="#" onclick="mascota()"><img src="/images/homeicono.png" alt="Icono Tienda"></a>
                    <a href="#" onclick="cementerio()"><img src="/images/Tumba.png" alt="Icono Cementerio"></a>
                </div>
            </div>           

      </div>

      <div class="p-2 ">   


        <div class="cementerio" id="cementerioContainer">
        </div>

        <div class="cerrar" id="cerrar">
            <a></a> <a></a>  <a></a> <a></a> <a></a> <a></a> <a></a> <a></a>
            <a href="#" onclick="cerrar()"><img src="/images/cerrar.png" alt="IconoCerrar"></a>
        </div>


        
      </div>



      <div class="p-2 "> 
       
      </div>

                
    </main>

    <footer>
      
    </footer>

  <script>
      function toggleSidebar() {
          var sidebar = document.getElementById('sidebar');
          if (sidebar.style.left === '0px') {
              sidebar.style.left = '-750px';
          } else {
              sidebar.style.left = '0px';
          }
      }
  </script>


<script>

    var cementerio = document.querySelector('.cementerio');

    // Obtener todos los elementos con clase "item" dentro de la tienda
    var items = cementerio.querySelectorAll('.item');
    let userId = '<%= user.id %>';

    // Crear una lista local para almacenar los elementos de la tienda
    //var listaCementerio = JSON.parse(localStorage.getItem('CementerioElements')) || [];
    //var listaCementerio = [];
    //localStorage.setItem('CementerioElements', JSON.stringify(listaCementerio));

    


    fetch(`/${userId}/muertos`)
        .then(response => response.json())
        .then(listaCementerio => {

            if (listaCementerio.length === 0) {
            items.forEach(function (item, index) {
            var imagenPrincipal = item.querySelector('img').src;
            var nombre = item.querySelector('.nombre').textContent;
            var fechamuerte = item.querySelector('.fechamuerte').textContent;
            
            /*
            var elementoCementerio = {
                imagenPrincipal: imagenPrincipal,
                nombre : nombre,
                fechamuerte: fechamuerte
            };

            listaCementerio.push(elementoCementerio); */
                });

            }


        })
        .catch(error => console.error('Error al obtener la lista de tareas:', error)); 
 
   // localStorage.setItem('CementerioElements', JSON.stringify(listaCementerio));
    //console.log(listaCementerio);

    window.onload = function() {
        
        function elementYaExisteEnMascota(elementData) {
            var CementerioContainer = document.querySelector('.cementerio');
            var items = CementerioContainer.querySelectorAll('.item');

            for (var i = 0; i < items.length; i++) {
                var nombreElement = items[i].querySelector('.nombre');
                if (nombreElement.textContent === elementData.nombre) {
                    return true; 
                }
            }

            return false; 
        }


        function cargarElementosGuardados() {
            var CementerioElementsContainer = document.querySelector('.cementerio');
            CementerioElementsContainer.innerHTML = '';
            //var listaCementerio = JSON.parse(localStorage.getItem('CementerioElements')) || [];
            fetch(`/${userId}/muertos`)
            .then(response => response.json())
            .then(listaCementerio => {
                listaCementerio.forEach(function (elementData) {
                    if (!elementYaExisteEnMascota(elementData)) {
                        var nuevoItem = document.createElement('div');
                        nuevoItem.classList.add('item');

                        var nuevaImagen = document.createElement('img');
                        nuevaImagen.src = elementData.imagenPrincipal;
                        nuevoItem.appendChild(nuevaImagen);
                        console.log(elementData.imagenPrincipal)

                        var nuevoNombre = document.createElement('p');
                        nuevoNombre.classList.add('nombre');
                        nuevoNombre.textContent = elementData.nombre;
                        nuevoItem.appendChild(nuevoNombre);

                        var fechaActual = new Date(elementData.fecha);
                        var options = { year: 'numeric', month: 'long', day: 'numeric' };
                        var fechaFormateada = fechaActual.toLocaleDateString(undefined, options);
                        var nuevoFecha = document.createElement('p');
                        nuevoFecha.classList.add('fechamuerte');
                        nuevoFecha.textContent = fechaFormateada;
                        nuevoItem.appendChild(nuevoFecha);

                        CementerioElementsContainer.appendChild(nuevoItem);
                    }
                });

            })
            .catch(error => console.error('Error al obtener la lista de tareas:', error));
 
         


        } 

        cargarElementosGuardados();
    }

</script>


<script>
    function checklist(){
        var userId = '<%= user.id %>';
    window.location.href = "/checklist/" + userId;

    }

    function index(){
        var userId = '<%= user.id %>';
        window.location.href = "/"  + userId;


    }


    function mascota(){
        var userId = '<%= user.id %>';
      window.location.href = "/mascota/" + userId;
    }

    function cerrar(){
        var userId = '<%= user.id %>';
        window.location.href = "/"  + userId;


    }
</script>

    <!--  <h1>Hello, world!</h1> -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
  </body>
</html>