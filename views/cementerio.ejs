<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>AcademiaBach</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <style>
 
        .cementerio {

            color: black;

        }

        .item {
            background-color: #acc1e5;
            border: 1px solid #1b184f;
            text-align: center;
            color: #000;
        }




      
  </style>
  </head>
    
 
  <body>
	<div class="d-flex flex-row min-vh-100">
		<div class="offcanvas offcanvas-start w-auto" id="navbarSupportedContent" style="background-color: #acc1e5;">
			<div class="offcanvas-header">
				<button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
			</div>

			<div class="offcanvas-body">
				<ul class="nav flex-column">
					<li class="nav-item">
						<a class="nav-link" aria-current="page" href="#" style="text-align:center" onclick="index()">
							<img src="/images/indexlogo.png" style="width: 100px;" >
						</a>
					</li>
                    <li class="nav-item">
						<a class="nav-link" aria-current="page" href="#" style="text-align:center" onclick="checklist()">
							<img src="/images/listaicono.png" style="width: 100px;" >
						</a>
					</li>
					<li class="nav-item">
						<a class="nav-link" aria-current="page" href="#" style="text-align:center" onclick="papelera()">
							<img src="/images/papeleralogo.png" style="width: 100px;">
						</a>
					</li>
                    <li class="nav-item" style="margin-right: -7%;">
                        <a class="nav-link" aria-current="page" href="#" style="text-align:center" onclick="mascota()">
                            <img src="/images/homeicono.png" style="width: 100px;">
                        </a>
                    </li>
					<li class="nav-item">
						<a class="nav-link" aria-current="page" href="#" style="text-align:center" onclick="tienda()">
							<img src="/images/tiendalogo.png" style="width: 100px;">
						</a>
					</li>

				</ul>
			</div>
		</div>

		<div class="offcanvas offcanvas-top" id="navbarSupportedContentTop" style="background-color: #acc1e5;">
			<div class="offcanvas-header">
				<button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
			</div>
			<div class="offcanvas-body">
				<ul class="nav flex-row">
                    <li class="nav-item"  style="margin-right: -2%; ">
						<a class="nav-link" aria-current="page" href="#" style="text-align:center" onclick="index()">
							<img src="/images/indexlogo.png" style="width: 55px;" >
						</a>
					</li>
                    <li class="nav-item" style="margin-right: -2%;">
                        <a class="nav-link" aria-current="page" href="#" style="text-align:center" onclick="checklist()">
                            <img src="/images/listaicono.png" style="width: 55px;">
                        </a>
                    </li>
					<li class="nav-item" style="margin-right: -2%; ">
						<a class="nav-link" aria-current="page" href="#" style="text-align:center" onclick="papelera()">
							<img src="/images/papeleralogo.png" style="width: 55px;">
						</a>
					</li>
                    <li class="nav-item" style="margin-right: -2%;">
                        <a class="nav-link" aria-current="page" href="#" style="text-align:center" onclick="mascota()">
                            <img src="/images/homeicono.png" style="width: 55px;">
                        </a>
                    </li>

                <li class="nav-item">
                    <a class="nav-link" aria-current="page" href="#" style="text-align:center" onclick="tienda()">
                        <img src="/images/tiendalogo.png" style="width: 60px;">
                    </a>
                </li>

				</ul>
			</div>
		</div>

        <div class="flex-grow-1 d-flex flex-lg-row flex-column" style="border:1px SOLID black;">
            <div class="p-2  flex-grow-1 d-flex flex-column  justify-content-start align-items-stretch"
                style="background-color:rgb(82,107,141); color:white">

				<div class="d-flex flex-row justify-content-between" style="width:100%;">
					<a type="button" data-bs-toggle="offcanvas" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation" class="d-none d-lg-block">
						<img src="/images/logo.png" style="width: 100px;">
					</a>

					<a type="button" data-bs-toggle="offcanvas" data-bs-target="#navbarSupportedContentTop" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation" class="d-lg-none">
						<img src="/images/logo.png" style="width: 80px;">
					</a>

				</div>


                <div class="container" style="margin-bottom: 50px;">
                    <div class="cementerio row "  id="cementerioContainer">

                   </div>
                </div> 
               

                
			</div>

		</div>


    </div>



<script>

    var cementerio = document.querySelector('.cementerio');
    
    var items = cementerio.querySelectorAll('.item');
    let userId = '<%= user.id %>';    


    fetch(`/${userId}/muertos`)
        .then(response => response.json())
        .then(listaCementerio => {

            if (listaCementerio.length === 0) {
            items.forEach(function (item, index) {
            var imagenPrincipal = item.querySelector('img').src;
            var nombre = item.querySelector('.nombre').textContent;
            var fechamuerte = item.querySelector('.fechamuerte').textContent;
            
            });

            }


        })
        .catch(error => console.error('Error al obtener la lista de tareas:', error)); 
 

    window.onload = function() {
        
        function elementYaExisteEnMascota(elementData) {
            var CementerioContainer = document.querySelector('.cementerio');
            var items = CementerioContainer.querySelectorAll('.item');

            for (var i = 0; i < items.length; i++) {
                var nombreElement = items[i].querySelector('.nombre');
                if (nombreElement.textContent === elementData.nombre) {
                    return true; 
                }
            }

            return false; 
        }


        function cargarElementosGuardados() {
            var CementerioElementsContainer = document.querySelector('.cementerio');
            CementerioElementsContainer.innerHTML = '';
           
            fetch(`/${userId}/muertos`)
            .then(response => response.json())
            .then(listaCementerio => {
                listaCementerio.forEach(function (elementData) {
                    if (!elementYaExisteEnMascota(elementData)) {
                        var nuevoItem = document.createElement('div');
                        nuevoItem.classList.add('item', 'col-xl-3', 'col-lg-4', 'col-md-6', 'col-12');

                        var nuevaImagen = document.createElement('img');
                        nuevaImagen.src = elementData.imagenPrincipal;
                        nuevoItem.appendChild(nuevaImagen);
                        console.log(elementData.imagenPrincipal)

                        var nuevoNombre = document.createElement('p');
                        nuevoNombre.classList.add('nombre');
                        nuevoNombre.textContent = elementData.nombre;
                        nuevoItem.appendChild(nuevoNombre);

                        var fechaActual = new Date(elementData.fecha);
                        var options = { year: 'numeric', month: 'long', day: 'numeric' };
                        var fechaFormateada = fechaActual.toLocaleDateString(undefined, options);
                        var nuevoFecha = document.createElement('p');
                        nuevoFecha.classList.add('fechamuerte');
                        nuevoFecha.textContent = fechaFormateada;
                        nuevoItem.appendChild(nuevoFecha);

                        CementerioElementsContainer.appendChild(nuevoItem);
                    }
                });

            })
            .catch(error => console.error('Error al obtener la lista de tareas:', error));
 
         


        } 

        cargarElementosGuardados();
    }

</script>


<script>
    function checklist(){
        var userId = '<%= user.id %>';
    window.location.href = "/checklist/" + userId;

    }

    function index(){
        var userId = '<%= user.id %>';
        window.location.href = "/"  + userId;


    }

    function mascota(){
        var userId = '<%= user.id %>';
      window.location.href = "/mascota/" + userId;
    }

    function papelera(){
			 var userId = '<%= user.id %>';
			 window.location.href = "/papelera/" + userId;
	 
		 }

	function tienda(){
        var userId = '<%= user.id %>';
        window.location.href = "/tienda/" + userId;
    }	


</script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
  </body>
</html>